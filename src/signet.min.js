function signetFactory(){"use strict";function a(a,b,c,d){for(var e=b,f=a[b],g=0;g<f.length;g++)e=f[g](e,c,d);return e}function b(a){return function(b){return a===typeof b}}function c(a,c){var d=b("undefined")(c.valueType)?"*":c.valueType[0],e=N(d),f=Array.isArray(a);return f&&"*"!==d&&(f=a.reduce(function(a,b){return a&&e(b)},!0)),f}function d(a,c){var d=Array.isArray(c.valueType)?c.valueType.length:Number.MAX_VALUE;return b("function")(a)&&a.length<=d}function e(a){return 0===a.length||a.filter(f).length>0}function f(a){var c=!b("function")(O[a.type]),d=b("string")(a.subType)&&"object"!==a.type;return c||d}function g(a){if("accept"!==a.reduce(T,"init"))throw new Error("Signature contains unkown data types.")}function h(a){if(1>=a)throw new Error("Invalid signature: all signatures must have input and output types")}function i(a){for(var b=0,c=0;c<a.length;c++)b+=a[c].optional?0:1;return b}function j(a,b){var c=a[0];if(c.length<b.length||b.length<i(c))throw new Error("Function parameter count and argument type count do not match")}function k(a,b){h(a),g(a),j(a,b)}function l(a,b,c){if(b===a)throw new TypeError(c)}function m(a){return a.split("=>")}function n(a,b,c){Object.defineProperty(a,b,{value:c,writeable:!1})}function o(a){return function(){return D(a)}}function p(a,b,c){return b.length>1&&(Object.defineProperty(a,"signature",{get:o(b),writeable:!1}),n(a,"signatureTree",b),n(a,"executionContext",c)),a}function q(a,b){var c=0===b&&"["===a[b],d=b===a.length-1&&"]"===a[b];return c||d}function r(a,b){return null!==a[b].match(/\s/)}function s(a){return function(b){for(var c=[],d="",e=0;e<b.length;e++){if(0===c.length&&b[e]===a){c.push(d),d=b.substring(e+1,b.length);break}q(b,e)||(d+=b[e])}return c.push(d),c}}function t(a,b){var c=s(b)(a);return"<"===b&&c[1]&&(c[1]=c[1].substring(0,c[1].length-1)),c}function u(a){for(var b=[],c=[],d="",e=0;e<a.length;e++)0===c.length&&";"===a[e]?(b.push(d),d=""):d+=a[e],"<"===a[e]?c.push("<"):">"===a[e]&&c.pop();return b.push(d),b}function v(a){var c=a.indexOf("object:")>-1?":":"<",d=t(a,c),e=d[0],f=d[1],g=b("string")(f)&&"<"===c;return{type:e,subType:g?void 0:f,valueType:g?u(f):void 0,optional:null!==a.match(/^(\[.*\])|(\(\))$/)}}function w(a){for(var b=[],c="",d=0;d<a.length;d++)","===a[d]?(b.push(v(c)),c=""):r(a,d)||(c+=a[d]);return b.push(v(c)),b}function x(a){var c=a.type;return b("undefined")(a.valueType)||(c+="<"+a.valueType.join(";")+">"),c}function y(a,b){return"skip"===a?b:b.slice(1)}function z(a,b){return 0===a.length||0===b.length}function A(a,b,c){var d="Expected type "+x(a[0])+" but got "+typeof b[0],e=a.slice(1),f=y(c,b),g=z(e,f);return l("fail",c,d),g?c:B(e,f,c)}function B(a,c,d){var e=b("undefined")(d)?"accept":d,f=U(e,a[0],c[0]);return A(a,c,f)}function C(a,b){var c=a.length<=b.length;return c?b.join(","):C(a,b.concat(["x"+b.length]))}function D(a){var b,c,d,e="";for(c=0;c<a.length;c++)for(c>0&&(e+=" => "),d=0;d<a[c].length;d++)d>0&&(e+=", "),b=x(a[c][d]),a[c][d].optional&&(b="["+b+"]"),e+=b;return e}function E(a,b){if(!N(a)(b))throw new Error("Expected return value of type "+a+" but got "+typeof b)}function F(a,b){I(a,b);var c=a.apply(a.executionContext,b),d=a.signatureTree.slice(1),e=d.length>1?"function":x(d[0][0]);return E(e,c),p(c,d,a.executionContext),d.length>1?J(c):c}function G(a){var b="return function enforceWrapper ("+C(a,[])+") {return callAndEnforce(signedFn, Array.prototype.slice.call(arguments));};",c=new Function(["signedFn","callAndEnforce"],b);return c(a,F)}function H(a,b,c){var d=m(a).map(w);return k(d,b),p(b,d,c)}function I(a,b){var c=B(a.signatureTree[0],Array.prototype.slice.call(b,0));l("skip",c,"Optional types were not fulfilled properly")}function J(a){var b=G(a);return p(b,a.signatureTree),n(b,"toString",a.toString.bind(a)),b}function K(a,b){if("undefined"!=typeof O[a])throw new Error("Cannot redefine type "+a);O[a]=b}function L(a){var b=a+", [object], [function] => boolean";return function(a,c){var d=V(b,c);K(a,d)}}function M(a,b){K(a,N(b))}function N(a){var b=v(a);return function(a){var c=O[b.type];if("undefined"==typeof c)throw new Error("Type "+x(b)+" is not known");try{return c(a,b)}catch(d){return!1}}}var O={"()":b("undefined"),any:function(){return!0},"*":function(){return!0},array:c,"boolean":b("boolean"),"function":d,number:b("number"),object:b("object"),string:b("string"),symbol:b("symbol"),undefined:b("undefined")},P=[function(a,b){return 1===b.length?"accept":"init"},function(a,b){return e(b)?"fail":a}],Q={init:P,accept:P,fail:[]},R=[function(a,b,c){return O[b.type](c,b,N)?"accept":"fail"},function(a,b){return b.optional&&"fail"===a?"skip":a}],S={skip:R,accept:R,fail:[]},T=a.bind(null,Q),U=a.bind(null,S),V=function(a,b,c){var d=N("undefined")(c)?null:c;return J(H(a,b,d))},W={alias:V("string, string => undefined",M),enforce:V("string, function, [object] => function",V),extend:V("string, function => undefined",K),isTypeOf:V("string => * => boolean",N),sign:V("string, function, [object] => function",H),subtype:V("string => string, function => undefined",L),verify:V("function, object => undefined",I)};return W}if("undefined"!=typeof module&&"undefined"!=typeof module.exports)module.exports=signetFactory;else var signet=signetFactory();