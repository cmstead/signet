function signetFactory(){"use strict";function n(n,e,t,r){for(var u=e,i=n[e],o=0;o<i.length;o++)u=i[o](u,t,r);return u}function e(n){return function(e){return n===typeof e}}function t(n,t){var r=e("undefined")(t.valueType)?"*":t.valueType[0],u=W(r),i=Array.isArray(n);return i&&"*"!==r&&(i=n.reduce(function(n,e){return n&&u(e)},!0)),i}function r(n,t){var r=Array.isArray(t.valueType)?t.valueType.length:Number.MAX_VALUE;return e("function")(n)&&n.length<=r}function u(n){return 0===n.length||n.filter(i).length>0}function i(n){var t=!e("function")(z[n.type]),r=e("string")(n.subType)&&"object"!==n.type;return t||r}function o(n){if("accept"!==n.reduce(J,"init"))throw new Error("Signature contains unkown data types.")}function a(n){if(1>=n)throw new Error("Invalid signature: all signatures must have input and output types")}function c(n){for(var e=0,t=0;t<n.length;t++)e+=n[t].optional?0:1;return e}function f(n,e){var t=n[0];if(t.length<e.length||e.length<c(t))throw new Error("Function parameter count and argument type count do not match")}function p(n,e){a(n),o(n),f(n,e)}function l(n,e,t){if(e===n)throw new TypeError(t)}function y(n){return n.split("=>")}function s(n,e,t){Object.defineProperty(n,e,{value:t,writeable:!1})}function d(n){return function(){return O(n)}}function g(n,e,t){return e.length>1&&(Object.defineProperty(n,"signature",{get:d(e),writeable:!1}),s(n,"signatureTree",e),s(n,"executionContext",t)),n}function h(n,e){var t=0===e&&"["===n[e],r=e===n.length-1&&"]"===n[e];return t||r}function v(n,e){return null!==n[e].match(/\s/)}function b(n){return function(e){for(var t=[],r="",u=0;u<e.length;u++){if(0===t.length&&e[u]===n){t.push(r),r=e.substring(u+1,e.length);break}h(e,u)||(r+=e[u])}return t.push(r),t}}function T(n,e){var t=b(e)(n);return"<"===e&&t[1]&&(t[1]=t[1].substring(0,t[1].length-1)),t}function m(n){for(var e=[],t=[],r="",u=0;u<n.length;u++)0===t.length&&";"===n[u]?(e.push(r),r=""):r+=n[u],"<"===n[u]?t.push("<"):">"===n[u]&&t.pop();return e.push(r),e}function w(n){var t=n.indexOf("object:")>-1?":":"<",r=T(n,t),u=r[0],i=r[1],o=e("string")(i)&&"<"===t;return{type:u,subType:o?void 0:i,valueType:o?m(i):void 0,optional:null!==n.match(/^(\[.*\])|(\(\))$/)}}function C(n){for(var e=[],t="",r=0;r<n.length;r++)","===n[r]?(e.push(w(t)),t=""):v(n,r)||(t+=n[r]);return e.push(w(t)),e}function j(n){var t=n.type;return e("undefined")(n.valueType)||(t+="<"+n.valueType.join(";")+">"),t}function x(n,e){return"skip"===n?e:e.slice(1)}function k(n,e){return 0===n.length||0===e.length}function E(n,e,t){var r="Expected type "+j(n[0])+" but got "+typeof e[0],u=n.slice(1),i=x(t,e),o=k(u,i);return l("fail",t,r),o?t:F(u,i,t)}function F(n,t,r){var u=e("undefined")(r)?"accept":r,i=K(u,n[0],t[0]);return E(n,t,i)}function A(n,e){var t=n.length<=e.length;return t?e.join(","):A(n,e.concat(["x"+e.length]))}function O(n){var e,t,r,u="";for(t=0;t<n.length;t++)for(t>0&&(u+=" => "),r=0;r<n[t].length;r++)r>0&&(u+=", "),e=j(n[t][r]),n[t][r].optional&&(e="["+e+"]"),u+=e;return u}function I(n,e){if(!W(n)(e))throw new Error("Expected return value of type "+n+" but got "+typeof e)}function S(n,e){P(n,e);var t=n.apply(n.executionContext,e),r=n.signatureTree.slice(1),u=r.length>1?"function":j(r[0][0]);return I(u,t),g(t,r,n.executionContext),r.length>1?U(t):t}function q(n){var e="return function enforceWrapper ("+A(n,[])+") {return callAndEnforce(signedFn, Array.prototype.slice.call(arguments));};",t=new Function(["signedFn","callAndEnforce"],e);return t(n,S)}function M(n,e,t){var r=y(n).map(C);return p(r,e),g(e,r,t)}function P(n,e){var t=F(n.signatureTree[0],Array.prototype.slice.call(e,0));l("skip",t,"Optional types were not fulfilled properly")}function U(n){var e=q(n);return g(e,n.signatureTree),s(e,"toString",n.toString.bind(n)),e}function L(n,e){if("undefined"!=typeof z[n])throw new Error("Cannot redefine type "+n);z[n]=e}function N(n,e){return function(t,r){return n(t,r)&&e(t,r)}}function R(n){var e=W(n);return function(t,r){L(t,N(e,r)),z[t].typeChain=X(n)+" -> "+t}}function V(n,e){var t=e.split(/(\<|\:)/)[0];L(n,W(e)),z[n].typeChain=X(t)+" -> "+n}function W(n){var e=w(n);return function(n){var t=z[e.type];if("undefined"==typeof t)throw new Error("Type "+j(e)+" is not known");try{return t(n,e)}catch(r){return!1}}}function X(n){var e=z.undefined,t=z[n],r=e(t)?"undefined type":t.typeChain;return e(r)?"* -> "+n:r}function $(n){return Object.keys(n).map(function(e){return{key:e,typeCheck:W(n[e])}})}function _(n){var e=$(n);return function(n){return e.reduce(function(e,t){return e&&t.typeCheck(n[t.key])},!0)}}var z={"()":e("undefined"),any:function(){return!0},"*":function(){return!0},array:t,"boolean":e("boolean"),"function":r,number:e("number"),object:e("object"),string:e("string"),symbol:e("symbol"),undefined:e("undefined")};z["*"].typeChain="*",z["()"].typeChain="* -> undefined -> ()",z.any.typeChain="* -> any",z.array.typeChain="* -> object -> array",z["boolean"].typeChain="* -> boolean",z["function"].typeChain="* -> function",z.number.typeChain="* -> number",z.object.typeChain="* -> object",z.string.typeChain="* -> string",z.symbol.typeChain="* -> symbol",z.undefined.typeChain="* -> undefined";var B=[function(n,e){return 1===e.length?"accept":"init"},function(n,e){return u(e)?"fail":n}],D={init:B,accept:B,fail:[]},G=[function(n,e,t){return z[e.type](t,e,W)?"accept":"fail"},function(n,e){return e.optional&&"fail"===n?"skip":n}],H={skip:G,accept:G,fail:[]},J=n.bind(null,D),K=n.bind(null,H),Q=function(n,e,t){var r=W("undefined")(t)?null:t;return U(M(n,e,r))},Y={alias:Q("string, string => undefined",V),duckTypeFactory:Q("object => function",_),enforce:Q("string, function, [object] => function",Q),extend:Q("string, function => undefined",L),isTypeOf:Q("string => * => boolean",W),sign:Q("string, function, [object] => function",M),subtype:Q("string => string, function => undefined",R),typeChain:Q("string => string",X),verify:Q("function, object => undefined",P)};return Y}function signetTypeFactory(){"use strict";function n(n){return Math.floor(n)===n}function e(n,e){var t=parseInt(e.valueType[0],10),r=parseInt(e.valueType[1],10);return n>=t&&r>=n}function t(n,e){var t="bounded<"+e.valueType.join(";")+">";return c.isTypeOf(t)(n)}function r(n,e,t){return c.isTypeOf(e)(n[t])}function u(n,e){return n.length===e.valueType.length&&e.valueType.map(r.bind(null,n)).reduce(function(n,e){return n&&e},!0)}function i(n,e){var t=parseInt(e.valueType[0],10),r=e.valueType.length>1?parseInt(e.valueType[1],10):n.length;return t<=n.length&&n.length<=r}function o(n,e){var t=new RegExp(e.valueType.join(";"));return null!==n.match(t)}function a(n,e){return e.valueType.reduce(function(e,t){return e||c.isTypeOf(t)(n)},!1)}var c="function"==typeof require?require("./signet")():signetFactory();return c.subtype("number")("int",n),c.subtype("number")("bounded",e),c.subtype("int")("boundedInt",t),c.subtype("array")("tuple",u),c.subtype("string")("boundedString",i),c.subtype("string")("formattedString",o),c.extend("taggedUnion",a),c}if("undefined"!=typeof module&&"undefined"!=typeof module.exports&&(module.exports=signetFactory),"undefined"!=typeof module&&"undefined"!=typeof module.exports)module.exports=signetTypeFactory;else var signet=signetTypeFactory();